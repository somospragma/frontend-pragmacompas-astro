---
import { getSession } from "auth-astro/server";
import { ModeToggle } from "../molecules/ModalToggle/ModeToggle";
import { UserMenu } from "../molecules/UserMenu";
import type { SessionUser } from "auth.config";
import { hasPermission } from "@/shared/utils/helpers/hasPermission";
import { Permission } from "@/shared/utils/enums/permission";

const session = (await getSession(Astro.request)) as SessionUser;
const userRole = session?.user?.rol ?? "";
const showMentoriasLink = hasPermission(userRole, Permission.VIEW_LINKED_MENTORIAS);
const showDashboardLink = hasPermission(userRole, Permission.VIEW_LINKED_DASHBOARD);
---

<header class="flex items-center justify-between border-b border-border bg-background px-6 py-4 w-full">
  <div class="flex items-center gap-4">
    <div class="flex items-center gap-3">
      <div class="flex items-center gap-2">
        <a href="/">
          <img
            src="/pragma-compas-black.svg"
            alt="Logo Pragma"
            width="200"
            height="40"
            class="h-[40px] w-[200px] block dark:hidden"
          />
          <img
            src="/pragma-compas-white.svg"
            alt="Logo Pragma"
            width="200"
            height="40"
            class="h-[40px] w-[200px] hidden dark:block"
          />
        </a>
      </div>
    </div>
  </div>

  <nav class="flex items-center gap-8 text-sm font-medium text-foreground">
    {
      showMentoriasLink && (
        <a href="/requests" class="hover:text-primary transition-colors px-3 py-2 rounded-md hover:bg-accent">
          Tutorías
        </a>
      )
    }
    <a href="/history" class="hover:text-primary transition-colors px-3 py-2 rounded-md hover:bg-accent">Historial</a>
    <a href="/tutoring-request" class="hover:text-primary transition-colors px-3 py-2 rounded-md hover:bg-accent"
      >Solicitar tutoría</a
    >
    {
      showDashboardLink && (
        <a href="/dashboard" class="hover:text-primary transition-colors px-3 py-2 rounded-md hover:bg-accent">
          Dashboard
        </a>
      )
    }
  </nav>

  <div class="flex items-center gap-3">
    <UserMenu user={session?.user} client:load />

    <ModeToggle client:load />
  </div>
</header>
